<div class="wa-host">
  <div class="wa-phone">
    <div class="wa-notch"></div>
    <div class="wa-top">
      <img class="wa-avatar" src="https://i.pravatar.cc/48?u=friend" alt="avatar">
      <div class="wa-title">
        <div class="wa-name">Simulation Bot</div>
        <div class="wa-sub">online</div>
      </div>
      <div class="wa-actions" aria-hidden="true">
        <button class="wa-icon-btn" title="options">⋮</button>
      </div>
    </div>

    <div class="wa-chat-area">
      <div class="wa-bg-layer" aria-hidden="true"></div>

      <div class="wa-messages" #scrollContainer>
        <ng-container *ngFor="let msg of messages; trackBy: trackById">
          <div class="wa-msg-row" [class.wa-mine]="msg.sender === me" [class.wa-theirs]="msg.sender !== me">
            <div class="wa-bubble" [attr.data-type]="msg.type">
              <div *ngIf="msg.type === 'text'" class="wa-text">{{ msg.content }}</div>

              <img *ngIf="msg.type === 'image'" [src]="msg.mediaUrl" alt="img" class="wa-media" />

              <video *ngIf="msg.type === 'video'" [src]="msg.mediaUrl" controls class="wa-media"></video>

              <a *ngIf="msg.type === 'file'" class="wa-file" [href]="msg.mediaUrl" target="_blank">{{ msg.fileName }}</a>

              <div *ngIf="msg.type === 'template'" class="wa-template">
                <div *ngIf="msg.headerText" class="wa-text wa-template-header"><strong>{{ msg.headerText }}</strong></div>
                <div *ngIf="msg.bodyText" class="wa-text wa-template-body">{{ msg.bodyText }}</div>
                <div *ngIf="msg.footerText" class="wa-text wa-template-footer">{{ msg.footerText }}</div>
                <div *ngIf="msg.buttons?.length" class="wa-buttons wa-template-buttons">
                  <button class="wa-quick wa-template-button" *ngFor="let b of (msg.buttons | slice:0:3)" (click)="handleButtonClick(b)">{{ b.label }}</button>
                </div>
              </div>

              <div *ngIf="msg.type === 'buttons'" class="wa-buttons">
                <button class="wa-quick" *ngFor="let b of msg.buttons" (click)="handleButtonClick(b)">{{ b.label }}</button>
              </div>

              <div class="wa-meta">
                <span class="wa-time">{{ msg.timestamp }}</span>

                <ng-container *ngIf="msg.sender === me">
                  <svg *ngIf="msg.status === 'pending' || !msg.status" class="wa-tick wa-tick-single" width="18" height="12" viewBox="0 0 24 24" aria-hidden="true">
                    <path fill="#97a0a6" d="M10.5 13.5L6 9l1.4-1.4 3.1 3.1 6-6L17.5 6l-7 7z"/>
                  </svg>

                  <svg *ngIf="msg.status === 'sent' || msg.status === 'delivered'" class="wa-tick wa-tick-double" width="18" height="12" viewBox="0 0 24 24" aria-hidden="true">
                    <path fill="#97a0a6" d="M10.5 13.5L6 9l1.4-1.4 3.1 3.1 6-6L17.5 6l-7 7z"/>
                    <path fill="#97a0a6" d="M16.5 13.5L12 9l1.4-1.4 3.1 3.1 3-3L22.5 9l-6 6z"/>
                  </svg>

                  <svg *ngIf="msg.status === 'read'" class="wa-tick wa-tick-double-read" width="18" height="12" viewBox="0 0 24 24" aria-hidden="true">
                    <path fill="#4fc3f7" d="M10.5 13.5L6 9l1.4-1.4 3.1 3.1 6-6L17.5 6l-7 7z"/>
                    <path fill="#4fc3f7" d="M16.5 13.5L12 9l1.4-1.4 3.1 3.1 3-3L22.5 9l-6 6z"/>
                  </svg>
                </ng-container>
              </div>
            </div>
          </div>
        </ng-container>
      </div>
    </div>

    <div class="wa-input-bar">
      <input class="wa-input" type="text" placeholder="Type a message" [(ngModel)]="newMessage" (keyup.enter)="sendText()" />

      <button class="wa-send" (click)="sendText()" aria-label="Send">➤</button>
    </div>
  </div>
</div>
